<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  {% load static %}
  <link rel="stylesheet" href="{% static 'css/output.css' %}">
  <title>Conversa</title>
</head>

<body>
  <input type="text" name="conversation_id" id="conversation_id" value="{{ conversation_id }}" hidden />
  <h1 id="conversation-title" class="font-medium">Conversa com ID: {{ conversation_id }}</h1>
</body>

<script>
  async function carregarMensagens() {
    try {
      const conversation_id =
        document.getElementById("conversation_id").value;
      const response = await fetch(`/conversations/${conversation_id}/`);
      const messages = await response.json();
      const body = document.body;
      // Adicionando o botÃ£o para voltar para a lista de conversas
      const button = document.createElement("button");
      button.innerText = "Voltar para a lista de conversas";
      button.onclick = () => {
        window.location.href = "/conversations/view/";
      };
      body.appendChild(button);

      // Adicionando dados da conversa ao corpo do documento
      const conversationStatus = document.createElement("p");
      conversationStatus.innerText = `Status da conversa: ${messages.status}`;
      body.appendChild(conversationStatus);
      const conversationCreatedAt = document.createElement("p");
      conversationCreatedAt.innerText = `Criada em: ${messages.created_at}`;
      body.appendChild(conversationCreatedAt);

      // Adicionando as mensagens ao corpo do documento
      messages.messages.forEach((message) => {
        let p = document.createElement("p");
        p.innerText = message.id;
        body.appendChild(p);
        p = document.createElement("p");
        p.innerText = message.direction;
        body.appendChild(p);
        p = document.createElement("p");
        p.innerText = message.content;
        body.appendChild(p);
        p = document.createElement("p");
        p.innerText = message.created_at;
        body.appendChild(p);
      });
    } catch (error) {
      console.error("Erro ao buscar mensagens:", error);
    }
  }
  console.log("Carregando mensagens...");
  carregarMensagens();
</script>

</html>